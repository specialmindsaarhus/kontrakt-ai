# Data Models Specification

## Overview

This document defines the data structures used throughout the CLI integration system. These TypeScript-style interfaces serve as documentation for JavaScript implementations.

## CLIRequest

Request object passed to CLI adapters for execution.

```typescript
interface CLIRequest {
  // The CLI provider to use ('claude', 'gemini', 'openai')
  provider: 'claude' | 'gemini' | 'openai';

  // Absolute path to the document to analyze
  documentPath: string;

  // Absolute path to directory containing reference materials (optional)
  referencePath?: string;

  // Absolute path to the system prompt file
  systemPromptPath: string;

  // Timeout in milliseconds (default: 300000 = 5 minutes)
  timeout?: number;

  // Additional metadata about the request
  metadata?: DocumentMetadata;
}
```

**Example:**
```javascript
{
  provider: 'claude',
  documentPath: 'C:\\Users\\user\\documents\\franchise-agreement.txt',
  referencePath: 'C:\\Users\\user\\reference-docs',
  systemPromptPath: 'C:\\Users\\user\\prompts\\franchise-contract-review.md',
  timeout: 300000,
  metadata: {
    originalFileName: 'franchise-agreement.pdf',
    originalFormat: 'pdf',
    clientName: 'Acme Franchise Inc.'
  }
}
```

## CLIResult

Result object returned from CLI adapter execution.

```typescript
interface CLIResult {
  // Whether the CLI execution succeeded
  success: boolean;

  // The CLI provider that was used
  provider: string;

  // The markdown output from the CLI (if successful)
  output?: string;

  // Error message (if failed)
  error?: string;

  // Error code for programmatic handling
  errorCode?: CLIErrorCode;

  // Execution time in milliseconds
  executionTime: number;

  // The CLI version that was used
  cliVersion?: string;

  // Raw stdout for debugging
  rawStdout?: string;

  // Raw stderr for debugging
  rawStderr?: string;
}
```

**Success Example:**
```javascript
{
  success: true,
  provider: 'claude',
  output: '## Kort vurdering\n\nThis franchise agreement...',
  executionTime: 45230,
  cliVersion: '1.2.3'
}
```

**Error Example:**
```javascript
{
  success: false,
  provider: 'claude',
  error: 'Claude CLI not found. Please install it from https://claude.ai/cli',
  errorCode: 'CLI_NOT_FOUND',
  executionTime: 120
}
```

## CLIErrorCode

Standardized error codes for CLI operations.

```typescript
enum CLIErrorCode {
  // CLI executable not found on system
  CLI_NOT_FOUND = 'CLI_NOT_FOUND',

  // CLI requires authentication
  AUTH_REQUIRED = 'AUTH_REQUIRED',

  // Document file not found
  FILE_NOT_FOUND = 'FILE_NOT_FOUND',

  // System prompt file not found
  PROMPT_NOT_FOUND = 'PROMPT_NOT_FOUND',

  // CLI execution timed out
  TIMEOUT = 'TIMEOUT',

  // CLI returned non-zero exit code
  EXECUTION_FAILED = 'EXECUTION_FAILED',

  // Unable to parse CLI output
  PARSE_ERROR = 'PARSE_ERROR',

  // Invalid request parameters
  INVALID_REQUEST = 'INVALID_REQUEST',

  // Unknown error
  UNKNOWN = 'UNKNOWN'
}
```

## DocumentMetadata

Additional metadata about the document being analyzed.

```typescript
interface DocumentMetadata {
  // Original filename before any conversions
  originalFileName: string;

  // Original file format ('pdf', 'docx', 'txt', etc.)
  originalFormat: string;

  // Client name (for report generation)
  clientName?: string;

  // Document type ('contract', 'manual', 'compliance')
  documentType?: string;

  // Date the document was uploaded/processed
  processedDate?: Date;

  // File size in bytes
  fileSize?: number;
}
```

## ReportConfig

Configuration for generating client-facing reports.

```typescript
interface ReportConfig {
  // Format for the report ('pdf', 'docx', 'md')
  format: 'pdf' | 'docx' | 'md';

  // Output file path
  outputPath: string;

  // The CLI result to generate report from
  cliResult: CLIResult;

  // Document metadata
  metadata: DocumentMetadata;

  // Consultant/company branding
  branding?: BrandingConfig;

  // Whether to include raw CLI output in report
  includeRawOutput?: boolean;
}
```

## BrandingConfig

Branding configuration for generated reports.

```typescript
interface BrandingConfig {
  // Consultant or company name
  companyName: string;

  // Logo file path (for PDF reports)
  logoPath?: string;

  // Footer text
  footerText?: string;

  // Primary color (hex code)
  primaryColor?: string;

  // Consultant email
  contactEmail?: string;

  // Consultant phone
  contactPhone?: string;
}
```

**Example:**
```javascript
{
  companyName: 'Special Minds ApS',
  logoPath: 'C:\\Users\\user\\branding\\logo.png',
  footerText: 'Generated by Special Minds Franchise Consulting',
  primaryColor: '#1a73e8',
  contactEmail: 'info@specialminds.com',
  contactPhone: '+45 12345678'
}
```

## CLIProvider

Information about an available CLI provider.

```typescript
interface CLIProvider {
  // Provider identifier
  name: 'claude' | 'gemini' | 'openai';

  // Display name for UI
  displayName: string;

  // Whether the CLI is installed and available
  available: boolean;

  // Installed version (if available)
  version?: string;

  // Installation URL
  installUrl: string;
}
```

**Example:**
```javascript
[
  {
    name: 'claude',
    displayName: 'Claude CLI',
    available: true,
    version: '1.2.3',
    installUrl: 'https://claude.ai/cli'
  },
  {
    name: 'gemini',
    displayName: 'Gemini CLI',
    available: false,
    installUrl: 'https://ai.google.dev/gemini-api/docs/cli'
  }
]
```

## FileConversionResult

Result from converting a file (PDF/DOCX) to text.

```typescript
interface FileConversionResult {
  // Whether conversion succeeded
  success: boolean;

  // Path to the converted text file
  textFilePath?: string;

  // Error message (if failed)
  error?: string;

  // Original file path
  originalFilePath: string;

  // Metadata about the conversion
  metadata?: {
    pageCount?: number;
    wordCount?: number;
    conversionTime?: number;
  };
}
```

## Usage Notes

### JavaScript Implementation

Since this project uses JavaScript (not TypeScript), these interfaces serve as documentation. Implement validation using runtime checks:

```javascript
function validateCLIRequest(request) {
  if (!request.provider || !['claude', 'gemini', 'openai'].includes(request.provider)) {
    throw new Error('Invalid provider');
  }
  if (!request.documentPath) {
    throw new Error('Document path is required');
  }
  if (!request.systemPromptPath) {
    throw new Error('System prompt path is required');
  }
  // Additional validation...
}
```

### Default Values

Apply sensible defaults when creating objects:

```javascript
function createCLIRequest(params) {
  return {
    timeout: 300000, // 5 minutes default
    ...params
  };
}
```
